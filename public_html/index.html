<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        <script src="./js/jquery-3.1.0.min.js"> </script>
        
        
        <script type="text/javascript">
            
            $(document).ready(function(){
                $("#areaJuego").hide();
                
               

            });
            
            function enviarJsonAlServidor(ws, j) {
                ws.send(JSON.stringify(j));
                console.log("enviando : " + JSON.stringify(j));
            }
            
            function conectar() {
                var canvas = document.getElementById("micanvas");
                var ctx    = canvas.getContext("2d");
                ctx.font   = "12px Arial";
                
                $("#formEntrar").hide();
                var wsUri = "ws://localhost:8081/TrucoArgento-Servidor/TrucoArgento";

                var websocket = new WebSocket(wsUri);

                websocket.onopen = function(evt) {
                    log("Conectado...");
                    var json = {
                        accion : "entraJuego",
                        nombre : nombre.value
                    };
                    enviarJsonAlServidor(websocket, json);
                };

                websocket.onmessage = function(event) {
                    var jsonData = JSON.parse(event.data);
                    if (jsonData.accion === "espera") {
                        log(jsonData.mensaje);
                    }
                    if (jsonData.accion === "a_jugar") {
                        console.log("Recibiendo json :" + jsonData);
                        //window.location = jsonData.href;
                        var cartas = JSON.parse(jsonData.cartas);
                        var x = 10;
                        
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        for (var i in cartas) {
                            console.log(cartas[i].palo + " " + cartas[i].valor);
                            ctx.strokeRect(x, 10, 100, 100);
                            ctx.fillText(cartas[i].valor + " " + cartas[i].palo, x+5 , 100);
                            x += 110;
                        }
                        
                        $("#log").hide();
                        $("#nombreJugador").text("Tu nombre : " + jsonData.nombreJugador);
                        $("#msjTurno").text("Es el turno de : " + jsonData.nombreTurno);
                        $("#areaJuego").show();
                        $("#botoneraEnvido").hide();
                        
                        if (!jsonData.tuTurno) {
                            $('#btnEnvido').prop('disabled', true);
                            $('#btnJuega').prop('disabled', true);
                            //console.log("No es tu turno")
                        }
                    }
                    
                    if (jsonData.accion === "cantoEnvido") {
                        $("#msjEnvido").text( jsonData.mensaje);
                        $("#msjTurno").text("Es el turno de : " + jsonData.nombreTurno);
                        $("#botoneraInicial").hide();
                        $("#botoneraEnvido").show();   
                    }
                    
                    if (jsonData.accion === "determinarEnvido") {
                        $("#msjEnvido").text("Resultado envido: " + jsonData.resultado);
                    }
                };

                websocket.onerror = function(evt) {
                    log("ojo!.. error:" + evt.data);
                };

                function log(mensaje) { //aqui mostrará el LOG de lo que está haciendo el WebSocket
                    var logDiv = document.getElementById("log");
                    logDiv.innerHTML += (mensaje + '<br/>');
                }
                
                
                $("#btnEnvido").click(function() {
                    var json = { accion : "cantoEnvido" };
                    $('#btnEnvido').prop('disabled', true);
                    $('#btnJuega').prop('disabled', true);
                    $("#msjGenerales").text("Esperando respuesta de jugador...");
                    enviarJsonAlServidor(websocket, json);
                });
                
                $("#btnAceptarEnvido").click(function() {
                    var json = { accion : "envidoAceptado" };
                    enviarJsonAlServidor(websocket, json);
                });
                
                $("#btnRechazarEnvido").click(function() {
                    
                });
        }
        </script>
    </head>
    <body>
        <h1>Truco Argento</h1>
        <form id="formEntrar">
            <label >Nombre:</label>
            <input id='nombre' name='nombre'/>
            <button type="button" onclick="conectar()">Entrar Juego</button>
        </form>
        
        <div id="log">
 
        </div>

        <div id="areaJuego">
            
            <h1> Area juego!</h1>
            
            <div id="nombreJugador"> </div>
            
            <canvas height="200" width="500" id="micanvas">
            Su navegador no soporta en elemento CANVAS</canvas>
            
            <div id="msjTurno"></div>
            <div id="msjGenerales"></div>
            <div id="msjEnvido"></div>
            
            <div id="botoneraInicial">
                <button id="btnEnvido" type="button">Envido</button>
                <button id="btnJuega"  type="button">Jugar carta</button>
            </div>
            
            <br>
            <div id="botoneraEnvido">
                <button id="btnAceptarEnvido" type="button">Aceptar Envido</button>
                <button id="btnRechazarEnvido" type="button">Rechazar Envido</button>
            </div>
            
            <button id="btnRetira" type="button">Irse al maso</button>
            
        </div>
        
        
    </body>
</html>